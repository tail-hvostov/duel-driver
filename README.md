# duel-driver
## Описание проекта
Задачей проекта Duel является написание драйвера для монохромного SPI-дисплея с разрешением 72x40, использующего контроллер SSD1306. Целевой платформой проекта является одноплатный компьютер OrangePi Zero 3 с ОС Armbian Linux 6.6.62-current-sunxi64.
## Установка дисплея
### Подключение к OrangePi
- VCC - 3v3
- SCL - PH6
- SDA - PH7
- RES - PC10
- DC  - PC7
- CS  - PH9
### Регистрация в Device Tree (выполняется однократно)
Важно! Перед выполнением указанных команд следует в Терминале перейти в директорию duel-driver.

Выполните следующие команды в Терминале:
```
dtc -@ -I dts -O dtb -o ssd1306.dtbo ssd1306-overlay.dts
sudo cp ssd1306.dtbo /boot/dtb/allwinner/overlay/sun50i-h616-ssd1306.dtbo
sudo nano /boot/armbianEnv.txt
```
В открывшемся документе следует найти строку вида ```overlays=xxx yyy ...``` и привести её к следующему виду:
```
overlays=xxx yyy ... ssd1306
```
Если в документе нет строки подобного вида, её можно добавить в конец файла следующим образом:
```
overlays=ssd1306
```
После выполнения всех вышеперечисленных операций перезагрузите устройство командой ```sudo reboot```.
## Простые загрузка и отключение драйвера (без автозапуска)
Важно! Перед выполнением указанных команд следует в Терминале перейти в директорию duel-driver.

Загрузка драйвера осуществляется командой ```sudo ./scripts/duel_load.sh```.

Отключение драйвера осуществляется командой ```sudo ./scripts/duel_unload.sh```.
## Описание драйвера
При загрузке Duel в директории /dev порождаются файлы трёх символьных устройств:
- /dev/duel0 - файл строкового устройства для записи текста;
- /dev/duel1 - файл быстрого сырого устройства для записи обычных графических данных;
- /dev/duel2 - файл простого сырого устройства для записи обычных графических данных.
